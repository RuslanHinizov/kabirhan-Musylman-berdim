# Race Vision Frontend

## Обзор

Фронтенд-приложение системы трансляции скачек на базе React 19 + TypeScript + Vite. Две основные страницы: Панель Оператора и Публичный Экран.

Система взаимодействует через WebSocket с бэкенд-сервером, управляющим 25 аналитическими камерами и 3 PTZ камерами трансляции. Аналитические камеры выполняют обнаружение лошадей на основе YOLO + CNN, в то время как PTZ камеры предоставляют только изображение трансляции для зрителей.

## Технологии

| Технология | Версия | Описание |
|-----------|-------|----------|
| React | 19.2.0 | Библиотека UI |
| TypeScript | 5.9.3 | Типобезопасный JavaScript |
| Vite | 7.2.4 | Инструмент сборки и сервер разработки |
| Zustand | 5.0.10 | Управление состоянием |
| Framer Motion | 12.29.2 | Анимации |
| Tailwind CSS | 4.1.18 | Utility-first CSS фреймворк |
| i18next | 25.8.0 | Поддержка мультиязычности |
| react-i18next | 16.5.4 | Интеграция React i18n |
| lucide-react | 0.563.0 | Библиотека иконок |
| hls.js | 1.6.15 | HLS streaming |
| react-router-dom | 7.13.0 | Маршрутизация страниц |

## Страницы

### Панель Оператора (`/operator`)

Панель управления для менеджмента гонки. Содержит 5 вкладок:

1. **PTZ Control** -- Выбор камеры трансляции (переключение между 3 PTZ камерами). Активная камера помечается значком "ON AIR".
2. **Camera Grid** -- Живое изображение с 25 аналитических камер (сетка 5x5). Каждую камеру можно развернуть.
3. **Track** -- Позиции лошадей на овальной 2D трассе отображаются с анимацией.
4. **RTSP Cameras** -- Конфигурация RTSP URL камер и управление запуском/остановкой.
5. **Race Settings** -- Параметры гонки, операции добавления/удаления лошадей.

### Публичный Экран (`/`)

Экран для зрителей. Полноэкранный вид трансляции:

- Полноэкранное видео с PTZ камеры (WebRTC, MJPEG fallback)
- Верхний левый угол: Время гонки и информация о круге
- Нижняя панель: Перемещающийся рейтинг с иконками жокеев (вид трансляции в стиле Дубая)
- Индикатор скорости (км/ч)
- Оверлей окончания гонки

## Структура Компонентов

### Компоненты Страниц

```
pages/
+-- OperatorPanel.tsx    -- Панель управления оператора с вкладками
+-- PublicDisplay.tsx    -- Полноэкранный вид для зрителей
```

### Компоненты Оператора

```
components/operator/
+-- CameraGrid.tsx       -- Сетка 25 камер (разворачиваемая)
+-- CameraSettings.tsx   -- Управление RTSP URL
+-- PTZControlPanel.tsx  -- Выбор PTZ камеры (значок ON AIR)
+-- Track2DView.tsx      -- Анимация овальной 2D трассы
+-- RaceSettings.tsx     -- Конфигурация гонки + лошадей
```

### Компоненты Публичного Экрана

```
components/public-display/
+-- PTZCameraDisplay.tsx -- Изображение PTZ камеры + оверлей информации
+-- RankingBoard.tsx     -- Карточки с иконками Silk с рейтингом
```

### Общие Компоненты

```
components/
+-- WebRTCPlayer.tsx     -- Видеоплеер WebRTC (MJPEG fallback)
+-- MJPEGPlayer.tsx      -- Плеер потока MJPEG (используется как fallback для WebRTC)
+-- RTSPPlayer.tsx       -- Плеер потока RTSP/HLS
+-- LanguageSelector.tsx -- Выпадающий список выбора языка
```

## Управление Состоянием (State Management - Zustand)

Приложение использует два основных хранилища (store):

### cameraStore.ts

Состояние и конфигурация камеры:

- `ptzCameras` -- Состояние 3 PTZ камер (url, online/offline, имя)
- `analyticsCameras` -- Состояние 25 аналитических камер
- `activePTZCameraId` -- ID активной камеры трансляции
- `streamMode` -- Переключение `'webrtc'` или `'mjpeg'`
- RTSP URL сохраняются в `localStorage`
- Синхронизация между вкладками (прослушивание события `storage`)

### raceStore.ts

Состояние гонки и рейтинг:

- `race` -- Информация о гонке (имя, круг, состояние)
- `horses` -- Список лошадей (имя, цвет, иконка silk)
- `rankings` -- Данные живого рейтинга
- `backendConnected` -- Состояние подключения к бэкенду

## Подключение к Бэкенду

Файл `src/services/backendConnection.ts` управляет связью с бэкендом через WebSocket:

- **Адрес:** `ws://localhost:8000/ws`
- **Автоматическое переподключение:** При разрыве соединения повторяет попытку каждые 3 секунды
- **Heartbeat:** Проверка ping/pong каждые 5 секунд
- **Типы сообщений:**
  - `ranking_update` -- Живое обновление рейтинга
  - `camera_detection` -- Результаты обнаружения камерами
  - `race_start` -- Уведомление о начале гонки
  - `race_stop` -- Уведомление об остановке гонки
  - `horses_detected` -- Уведомление об обнаружении лошади
  - `state` -- Общая синхронизация состояния

## Конфигурация Камер

Определяется в файле `src/config/cameras.ts`:

### Аналитические Камеры (25 штук)

- ID: от `analytics-1` до `analytics-25`
- Каждая камера покрывает сегмент трассы 100 метров
- Общее покрытие: 2500 метров
- Используются только для обнаружения YOLO + CNN, зрителям не показываются

### PTZ Камеры (3 штуки)

- `ptz-1` -- Точка старта (0м)
- `ptz-2` -- Середина (1250м)
- `ptz-3` -- Точка финиша (2500м)
- Используются только для трансляции, обнаружение не выполняется

### Начальное Состояние

- Все камеры в начале offline
- RTSP URL пустые
- URL настраиваются из панели оператора

## Поддержка Языков (i18n)

Настраивается в папке `src/i18n/`. Поддерживается 4 языка:

| Код | Язык | Файл |
|-----|-----|-------|
| EN | Английский | `locales/en.ts` |
| TR | Турецкий | `locales/tr.ts` |
| RU | Русский | `locales/ru.ts` |
| KK | Казахский | `locales/kk.ts` |

Особенности:

- Язык по умолчанию: Английский (EN)
- Автоматическое определение языка браузера
- Сохранение предпочтений в `localStorage`
- Синхронизация языка между вкладками
- Все тексты UI переведены

## Система Стилей

- Используются utility-классы Tailwind CSS 4
- Дизайн темной темы
- CSS custom properties (токены дизайна):

| Переменная | Значение | Описание |
|----------|-------|----------|
| `--background` | `#09090B` | Основной фон |
| `--surface` | `#18181B` | Фон карточки/панели |
| `--primary` | `#3B82F6` | Основной цвет (синий) |
| `--accent` | `#10B981` | Цвет акцента (зеленый) |

- Специальные компоненты: `.racing-card`, `.racing-button`, `.live-badge`
- Анимация пульсирующего значка LIVE (индикатор прямого эфира)

## Запуск

### Требования

- Node.js 18+
- Бэкенд-сервер: `http://localhost:8000`

### Разработка

```bash
npm install          # Установка зависимостей
npm run dev          # Сервер разработки (http://localhost:5173)
```

### Production Build

```bash
npm run build        # Сборка production в папку dist/
npm run preview      # Предпросмотр сборки production
```

### Lint

```bash
npm run lint         # Проверка кода с ESLint
```

## Иконки Жокейских Жилетов (Silk Icons)

В папке `public/assets/silks/` находится 10 иконок жокеев в формате SVG:

- `silk_1.svg` -- `silk_10.svg`
- Каждая лошадь сопоставляется с иконкой silk
- Разработаны как цветные жилеты жокеев
- Используются на доске рейтинга и в виде трассы

## Структура Папок

```
Kabirhan-Frontend/
+-- public/
|   +-- assets/
|       +-- silks/              -- SVG иконки жокейских жилетов
+-- src/
|   +-- components/
|   |   +-- operator/           -- Компоненты панели оператора
|   |   +-- public-display/     -- Компоненты экрана для зрителей
|   |   +-- WebRTCPlayer.tsx
|   |   +-- MJPEGPlayer.tsx
|   |   +-- RTSPPlayer.tsx
|   |   +-- LanguageSelector.tsx
|   +-- config/
|   |   +-- cameras.ts          -- Определения камер
|   +-- i18n/
|   |   +-- index.ts            -- Конфигурация i18n
|   |   +-- locales/            -- Файлы языков (en, tr, ru, kk)
|   +-- pages/
|   |   +-- OperatorPanel.tsx
|   |   +-- PublicDisplay.tsx
|   +-- services/
|   |   +-- backendConnection.ts -- Подключение WebSocket
|   +-- store/
|       +-- cameraStore.ts      -- State камеры
|       +-- raceStore.ts        -- State гонки
+-- package.json
+-- vite.config.ts
+-- tsconfig.json
+-- tailwind.config.ts
```
